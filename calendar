<!DOCTYPE html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tuna Universitária do Porto</title>

    <!-- Fonts & Libraries -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link rel="icon" href="images/TUP_Icon.png" type="image/png" />

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: "Lato", Arial, sans-serif;
        color: #ffffff;
        background-color: #111;
        line-height: 1.8;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      nav {
        background-color: #111;
        padding: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
      }

      .nav-left,
      .nav-right {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      nav a {
        color: white;
        text-decoration: none;
        font-weight: bold;
        padding: 10px 18px;
        border-radius: 6px;
        transition: background 0.3s, transform 0.2s;
      }

      nav a:hover {
        background-color: #333;
        transform: scale(1.05);
      }

      .language-selector {
        position: relative;
        color: white;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 6px;
        background: none;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
      }

      .language-dropdown {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background: #111;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        min-width: 160px;
        z-index: 10;
      }

      .language-selector.active .language-dropdown {
        display: block;
      }

      .language-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        color: white;
        background: none;
        border: none;
        width: 100%;
        cursor: pointer;
      }

      .language-option:hover {
        background: #333;
      }

      .language-flag {
        width: 22px;
        height: 16px;
        border-radius: 3px;
        border: 1px solid #fff;
      }

      main {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .calendar-container {
        display: flex;
        gap: 40px;
        align-items: flex-start;
        justify-content: center;
      }

      .calendar {
        background: #333;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        width: 460px;
        max-width: 100%;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .calendar-header h2 {
        margin: 0;
        font-size: 1.8rem;
        text-transform: capitalize;
      }

      .calendar-header button {
        background-color: #555;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
      }

      .days-of-week,
      .days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-gap: 7px;
        text-align: center;
        margin-bottom: 10px;
      }

      .day {
        padding: 10px;
        font-weight: bold;
      }

      .day-cell {
        width: 60px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #000;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.2rem;
        user-select: none;
      }

      .day-cell:hover {
        background-color: #ddd;
        color: black;
      }

      .current-day {
        background-color: #b19c24;
        color: white;
      }

      .day-cell.past-day {
        background-color: #555;
        color: #aaa;
        cursor: default;
      }

      .day-cell.past-day:hover {
        background-color: #555;
        color: #aaa;
      }

      /* Event day highlight */
      .day-cell.event-day {
        background-color: #b14444 !important;
        position: relative;
      }

      .day-cell.event-day:hover {
        background-color: #d25a5a !important;
        color: white;
      }

      /* Event details panel */
      .event-details {
        background: #222;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }

      .event-details img {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .contact-section {
        background: #222;
        color: #fff;
        text-align: center;
        padding: 10px 0;
        margin-top: auto;
        flex-shrink: 0;
      }

      .contact-link {
        color: #ffd700;
        text-decoration: none;
      }

      .contact-section .fa-brands {
        margin: 0 12px;
        color: #ffd700;
        font-size: 2.6em;
        transition: transform 0.3s;
      }

      .contact-section .fa-brands:hover {
        transform: scale(1.1);
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-left">
        <a href="main" data-i18n="start">Início</a>
        <a href="calendar.html" data-i18n="calendar">Calendário</a>
        <a href="tours.html" data-i18n="tours">Digressões</a>
        <a href="festivals.html" data-i18n="festivals">Festivais</a>
        <a href="merch.html" data-i18n="merch">Merch</a>
      </div>
      <div class="nav-right">
        <div class="language-selector" onclick="toggleLanguageDropdown(this)">
          <span data-i18n="idioms">Idioma</span>
          <div class="language-dropdown">
            <button class="language-option" data-lang="pt"><img class="language-flag" src="https://flagcdn.com/pt.svg" />Português</button>
            <button class="language-option" data-lang="en"><img class="language-flag" src="https://flagcdn.com/gb.svg" />English</button>
            <button class="language-option" data-lang="es"><img class="language-flag" src="https://flagcdn.com/es.svg" />Español</button>
            <button class="language-option" data-lang="fr"><img class="language-flag" src="https://flagcdn.com/fr.svg" />Français</button>
            <button class="language-option" data-lang="de"><img class="language-flag" src="https://flagcdn.com/de.svg" />Deutsch</button>
            <button class="language-option" data-lang="it"><img class="language-flag" src="https://flagcdn.com/it.svg" />Italian</button>
          </div>
        </div>
        <a href="login.html" data-i18n="login">Entrar</a>
      </div>
    </nav>

    <main>
      <div class="calendar-container">
        <div class="calendar">
          <div class="calendar-header">
            <button id="prevMonthBtn">❮</button>
            <h2 id="monthYear"></h2>
            <button id="nextMonthBtn">❯</button>
          </div>
          <div class="days-of-week" id="daysOfWeek"></div>
          <div class="days" id="days"></div>
        </div>

        <!-- Event details panel -->
        <div class="event-details" id="eventDetails" style="display: none;">
          <img id="eventImage" src="" alt="Event Image" />
          <h3 id="eventTitle"></h3>
          <p id="eventDescription"></p>
        </div>
      </div>
    </main>

    <div class="contact-section">
      <p>
        <strong data-i18n="email">Email:</strong>
        <a class="contact-link" href="mailto:orfeao@orfeao.up.pt">orfeao@orfeao.up.pt</a><br />
        <strong data-i18n="address">Morada:</strong> Rua dos Bragas, 289, 4050-123 Porto<br />
        <strong data-i18n="phone">Telefone:</strong> (+351) 915 260 290/1<br />
        <strong data-i18n="bookings">Actuações:</strong>
        <a class="contact-link" href="https://orfeao.up.pt/marcacoes" target="_blank" data-i18n="bookings_link">Agendar</a>
      </p>
      <p>
        <a href="https://facebook.com/tup" target="_blank"><i class="fa-brands fa-facebook"></i></a>
        <a href="https://instagram.com/tup" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        <a href="https://youtube.com/tup" target="_blank"><i class="fa-brands fa-youtube"></i></a>
      </p>
    </div>

    <script>
      // i18n translations (same as before)
      const translations = {
        pt: {
          start: "Início",
          calendar: "Calendário",
          tours: "Digressões",
          festivals: "Festivais",
          merch: "Merch",
          idioms: "Idioma",
          login: "Entrar",
          email: "Email",
          address: "Morada",
          phone: "Telefone",
          bookings: "Actuações",
          bookings_link: "Agendar"
        },
        en: {
          start: "Home",
          calendar: "Calendar",
          tours: "Tours",
          festivals: "Festivals",
          merch: "Merch",
          idioms: "Language",
          login: "Login",
          email: "Email",
          address: "Address",
          phone: "Phone",
          bookings: "Bookings",
          bookings_link: "Book Now"
        },
        es: {
          start: "Inicio",
          calendar: "Calendario",
          tours: "Giras",
          festivals: "Festivales",
          merch: "Merch",
          idioms: "Idioma",
          login: "Entrar",
          email: "Correo",
          address: "Dirección",
          phone: "Teléfono",
          bookings: "Actuaciones",
          bookings_link: "Reservar"
        },
        fr: {
          start: "Accueil",
          calendar: "Calendrier",
          tours: "Tournées",
          festivals: "Festivals",
          merch: "Merch",
          idioms: "Langue",
          login: "Connexion",
          email: "Email",
          address: "Adresse",
          phone: "Téléphone",
          bookings: "Réservations",
          bookings_link: "Réserver"
        },
        de: {
          start: "Startseite",
          calendar: "Kalender",
          tours: "Touren",
          festivals: "Festivals",
          merch: "Merch",
          idioms: "Sprache",
          login: "Anmelden",
          email: "Email",
          address: "Adresse",
          phone: "Telefon",
          bookings: "Buchungen",
          bookings_link: "Buchen"
        },
        it: {
          start: "Inizio",
          calendar: "Calendario",
          tours: "Tour",
          festivals: "Festival",
          merch: "Merch",
          idioms: "Lingua",
          login: "Accesso",
          email: "Email",
          address: "Indirizzo",
          phone: "Telefono",
          bookings: "Prenotazioni",
          bookings_link: "Prenota"
        }
      };

      let currentLang = 'pt';

      function updateAllTranslations() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          el.textContent = translations[currentLang][key] || el.textContent;
        });
      }

      // Language dropdown logic
      function toggleLanguageDropdown(el) {
        el.classList.toggle('active');
      }

      document.querySelectorAll('.language-option').forEach(btn => {
        btn.addEventListener('click', e => {
          currentLang = e.currentTarget.getAttribute('data-lang');
          updateAllTranslations();
          // Close dropdown
          document.querySelector('.language-selector').classList.remove('active');
        });
      });

      // Calendar Logic
      const daysOfWeekNames = {
        pt: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
        en: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        es: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
        fr: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
        de: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
        it: ['Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom']
      };

      let events = {};

      let today = new Date();
      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();
      let selectedDate = null;

      const monthNamesPt = [
        'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
        'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
      ];

      function renderWeekdays() {
        const daysOfWeek = document.getElementById('daysOfWeek');
        daysOfWeek.innerHTML = '';
        daysOfWeekNames[currentLang].forEach(dayName => {
          const dayElem = document.createElement('div');
          dayElem.className = 'day';
          dayElem.textContent = dayName;
          daysOfWeek.appendChild(dayElem);
        });
      }

      function renderCalendar() {
        const daysContainer = document.getElementById('days');
        daysContainer.innerHTML = '';

        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const daysInMonth = lastDay.getDate();

        const monthYear = document.getElementById('monthYear');
        monthYear.textContent = `${monthNamesPt[currentMonth]} ${currentYear}`;

        const firstWeekday = firstDay.getDay();
        // Adjust for Monday start (0=Sunday, so Monday=1)
        let startOffset = firstWeekday === 0 ? 6 : firstWeekday - 1;

        // Add empty cells before first day
        for (let i = 0; i < startOffset; i++) {
          const emptyCell = document.createElement('div');
          emptyCell.className = 'day-cell past-day';
          emptyCell.textContent = '';
          daysContainer.appendChild(emptyCell);
        }

        // Populate days
        for (let day = 1; day <= daysInMonth; day++) {
          const dayCell = document.createElement('div');
          dayCell.classList.add('day-cell');
          dayCell.textContent = day;

          // Format date key for events: YYYY-MM-DD
          const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

          // Past days are disabled
          const now = new Date();
          const isPast = new Date(currentYear, currentMonth, day) < new Date(now.getFullYear(), now.getMonth(), now.getDate());
          if (isPast) {
            dayCell.classList.add('past-day');
            dayCell.style.cursor = 'default';
          } else if (day === now.getDate() && currentMonth === now.getMonth() && currentYear === now.getFullYear()) {
            dayCell.classList.add('current-day');
          }

          // If event day, mark
          if (events[dateKey]) {
            dayCell.classList.add('event-day');
            dayCell.title = events[dateKey].title;
          }

          // Only attach click listener if not past
          if (!dayCell.classList.contains('past-day')) {
            dayCell.addEventListener('click', () => selectDate(day));
          }

          daysContainer.appendChild(dayCell);
        }
      }

      function selectDate(day) {
        const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        selectedDate = day;

        if (events[dateKey]) {
          document.getElementById('eventImage').src = events[dateKey].image;
          document.getElementById('eventTitle').textContent = events[dateKey].title;
          document.getElementById('eventDescription').textContent = events[dateKey].description;
          document.getElementById('eventDetails').style.display = 'block';
        } else {
          document.getElementById('eventDetails').style.display = 'none';
        }
      }

      document.getElementById('prevMonthBtn').addEventListener('click', () => {
        if (currentMonth === 0) {
          currentMonth = 11;
          currentYear--;
        } else {
          currentMonth--;
        }
        renderCalendar();
        // Hide event details when month changes
        document.getElementById('eventDetails').style.display = 'none';
      });

      document.getElementById('nextMonthBtn').addEventListener('click', () => {
        if (currentMonth === 11) {
          currentMonth = 0;
          currentYear++;
        } else {
          currentMonth++;
        }
        renderCalendar();
        document.getElementById('eventDetails').style.display = 'none';
      });

      // Fetch events from JSON, then render calendar
      fetch('events.json')
        .then(response => response.json())
        .then(data => {
          events = data;
          renderWeekdays();
          renderCalendar();
          updateAllTranslations();
        })
        .catch(err => {
          console.error('Failed to load events:', err);
          // Still render calendar without events
          renderWeekdays();
          renderCalendar();
          updateAllTranslations();
        });

      // Initialize language selector text
      updateAllTranslations();

      // Close language dropdown if clicking outside
      document.addEventListener('click', e => {
        const langSelector = document.querySelector('.language-selector');
        if (!langSelector.contains(e.target)) {
          langSelector.classList.remove('active');
        }
      });
    </script>
  </body>
</html>
